<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>냠냠코치 - 회원가입</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <a href="index.html" class="navbar-brand h1">💪 냠냠코치</a>
                            <h1 class="h3 mt-2">회원가입</h1>
                        </div>
                         <form id="signup-form">
                            <div class="mb-3">
                                <label for="email" class="form-label">이메일</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                             <div class="mb-3">
                                <label for="password" class="form-label">비밀번호</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>
                             <div class="mb-3">
                                <label for="name" class="form-label">이름</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                            <div class="mb-3">
                                <label for="age" class="form-label">나이</label>
                                <input type="number" class="form-control" id="age" required>
                            </div>
                             <div class="row">
                                 <div class="col-md-6 mb-3">
                                    <label for="height" class="form-label">키 (cm)</label>
                                    <input type="number" class="form-control" id="height">
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label for="weight" class="form-label">몸무게 (kg)</label>
                                     <input type="number" class="form-control" id="weight">
                                 </div>
                             </div>
                             <div class="mb-3">
                                 <label for="conditions" class="form-label">질환 정보 (선택)</label>
                                 <input type="text" class="form-control" id="conditions" placeholder="예: 당뇨, 고혈압">
                             </div>
                             <div class="d-grid">
                                <button type="submit" class="btn btn-success btn-lg">가입하기</button>
                             </div>
                             <div class="text-center mt-3">
                                 <a href="login.html">이미 계정이 있으신가요? 로그인</a>
                             </div>
                         </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('signup-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = document.getElementById('name').value;
            const age = document.getElementById('age').value;
            const height = document.getElementById('height').value;
            const weight = document.getElementById('weight').value;
            const conditions = document.getElementById('conditions').value;

            const users = JSON.parse(localStorage.getItem('yumyum_users')) || [];

            const existingUser = users.find(user => user.email === email);
            if (existingUser) {
                alert('이미 가입된 이메일입니다.');
                return;
            }

            const newUser = {
                email, 
                password, // 실제 앱에서는 비밀번호를 해싱하여 저장해야 합니다.
                name, 
                age,
                height, 
                weight, 
                conditions
            };

            users.push(newUser);
            localStorage.setItem('yumyum_users', JSON.stringify(users));

            // 사용자 데이터 초기화
            try {
                const [dietResponse, challengesResponse, communityResponse] = await Promise.all([
                    fetch('./data/diet-data.json'),
                    fetch('./data/challenges.json'),
                    fetch('./data/community.json')
                ]);

                const dietData = await dietResponse.json();
                const challengesData = await challengesResponse.json();
                const communityData = await communityResponse.json();

                const initialUserData = {
                    meals: dietData.meals,
                    challenges: challengesData.challenges,
                    posts: communityData.posts,
                    goals: dietData.nutritionGoals
                };

                const db = JSON.parse(localStorage.getItem('yumyum_data')) || {};
                db[newUser.email] = initialUserData;
                localStorage.setItem('yumyum_data', JSON.stringify(db));

            } catch (error) {
                console.error("초기 사용자 데이터 설정에 실패했습니다:", error);
                // 에러 발생 시 빈 데이터로 초기화
                const db = JSON.parse(localStorage.getItem('yumyum_data')) || {};
                db[newUser.email] = { meals: [], challenges: [], posts: [], goals: { dailyCalories: 2000, protein: 100, carbs: 250, fat: 65 } };
                localStorage.setItem('yumyum_data', JSON.stringify(db));
            }

            alert('회원가입이 완료되었습니다. 로그인 페이지로 이동합니다.');
            window.location.href = 'login.html';
        });
    </script>
</body>
</html>