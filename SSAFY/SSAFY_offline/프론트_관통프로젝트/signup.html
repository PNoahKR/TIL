<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëƒ ëƒ ì½”ì¹˜ - íšŒì›ê°€ì…</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <a href="index.html" class="navbar-brand h1">ğŸ’ª ëƒ ëƒ ì½”ì¹˜</a>
                            <h1 class="h3 mt-2">íšŒì›ê°€ì…</h1>
                        </div>
                         <form id="signup-form">
                            <div class="mb-3">
                                <label for="email" class="form-label">ì´ë©”ì¼</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                             <div class="mb-3">
                                <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                                <input type="password" class="form-control" id="password" required>
                            </div>
                             <div class="mb-3">
                                <label for="name" class="form-label">ì´ë¦„</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                            <div class="mb-3">
                                <label for="age" class="form-label">ë‚˜ì´</label>
                                <input type="number" class="form-control" id="age" required>
                            </div>
                             <div class="row">
                                 <div class="col-md-6 mb-3">
                                    <label for="height" class="form-label">í‚¤ (cm)</label>
                                    <input type="number" class="form-control" id="height">
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label for="weight" class="form-label">ëª¸ë¬´ê²Œ (kg)</label>
                                     <input type="number" class="form-control" id="weight">
                                 </div>
                             </div>
                             <div class="mb-3">
                                 <label for="conditions" class="form-label">ì§ˆí™˜ ì •ë³´ (ì„ íƒ)</label>
                                 <input type="text" class="form-control" id="conditions" placeholder="ì˜ˆ: ë‹¹ë‡¨, ê³ í˜ˆì••">
                             </div>
                             <div class="d-grid">
                                <button type="submit" class="btn btn-success btn-lg">ê°€ì…í•˜ê¸°</button>
                             </div>
                             <div class="text-center mt-3">
                                 <a href="login.html">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
                             </div>
                         </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('signup-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = document.getElementById('name').value;
            const age = document.getElementById('age').value;
            const height = document.getElementById('height').value;
            const weight = document.getElementById('weight').value;
            const conditions = document.getElementById('conditions').value;

            const users = JSON.parse(localStorage.getItem('yumyum_users')) || [];

            const existingUser = users.find(user => user.email === email);
            if (existingUser) {
                alert('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
                return;
            }

            const newUser = {
                email, 
                password, // ì‹¤ì œ ì•±ì—ì„œëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹±í•˜ì—¬ ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤.
                name, 
                age,
                height, 
                weight, 
                conditions
            };

            users.push(newUser);
            localStorage.setItem('yumyum_users', JSON.stringify(users));

            // ì‚¬ìš©ì ë°ì´í„° ì´ˆê¸°í™”
            try {
                const [dietResponse, challengesResponse, communityResponse] = await Promise.all([
                    fetch('./data/diet-data.json'),
                    fetch('./data/challenges.json'),
                    fetch('./data/community.json')
                ]);

                const dietData = await dietResponse.json();
                const challengesData = await challengesResponse.json();
                const communityData = await communityResponse.json();

                const initialUserData = {
                    meals: dietData.meals,
                    challenges: challengesData.challenges,
                    posts: communityData.posts,
                    goals: dietData.nutritionGoals
                };

                const db = JSON.parse(localStorage.getItem('yumyum_data')) || {};
                db[newUser.email] = initialUserData;
                localStorage.setItem('yumyum_data', JSON.stringify(db));

            } catch (error) {
                console.error("ì´ˆê¸° ì‚¬ìš©ì ë°ì´í„° ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
                const db = JSON.parse(localStorage.getItem('yumyum_data')) || {};
                db[newUser.email] = { meals: [], challenges: [], posts: [], goals: { dailyCalories: 2000, protein: 100, carbs: 250, fat: 65 } };
                localStorage.setItem('yumyum_data', JSON.stringify(db));
            }

            alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            window.location.href = 'login.html';
        });
    </script>
</body>
</html>